{"version":3,"sources":["webpack:///./background/background.js","webpack:///./background/testing.js","webpack:///./global/workflows.js","webpack:///./background/form_util.js","webpack:///./background/context_menu.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["/* eslint complexity:0, max-nested-callbacks: [1,5] */\nimport Testing from \"./testing\";\nimport FormUtil from \"./form_util\";\nimport JSONF from \"../global/jsonf\";\nimport Rules from \"../global/rules\";\nimport Workflows from \"../global/workflows\";\nimport Utils from \"../global/utils\";\nimport Logger from \"../debug/logger\";\nimport Libs from \"../global/libs\";\nimport ContextMenu from \"./context_menu\";\nimport Storage from \"../global/storage\";\n\nContextMenu.init();\n\nwindow.lastActiveTab = null;\nvar lastMatchingRules = [];\nvar totalMatchesCount = 0;\nvar runWorkflowOrRule;\nvar optionSettings = null;\nvar recheckInterval = null;\n\nvar defaultBadgeBgColor = [0, 136, 255, 200];\nvar intervalBadgeBgColor = [43, 206, 7, 255];\nvar useBadgeBgColor = defaultBadgeBgColor;\n\n/*eslint-disable no-unused-vars*/\nvar testingMode = false;\n/*eslint-enable no-unused-vars*/\n\n// set the browser action badge\nvar setBadge = function(txt, tabId) {\n  chrome.browserAction.setBadgeText({\"text\": txt, \"tabId\": tabId});\n  chrome.browserAction.setBadgeBackgroundColor({\"color\": useBadgeBgColor, \"tabId\": tabId});\n\n  Testing.setVar(\"browser-action-badge-text\", txt, \"Browser action badge text\");\n};\n\n// Shows number of matches in the extension's icon\nvar refreshMatchCounter = function (tab, count) {\n  var txt = chrome.i18n.getMessage(\"no_match_available\");\n  if (count && count > 0) {\n    txt = count.toString();\n  }\n  setBadge(txt, tab.id);\n};\n\n// Testcode: Fill testing HTML with macthing rules\nvar reportMatchingRulesForTesting = function(matchingRules, lastMatchingWorkflows) {\n  /*eslint-disable max-nested-callbacks*/\n  var mRule = matchingRules.map(function (rule) {\n    return rule.prettyPrint();\n  }).join(\",\");\n  /*eslint-enable max-nested-callbacks*/\n  Testing.setVar(\"matching-rules-count\", matchingRules.length, \"Matching rule #\");\n  Testing.setVar(\"matching-rules-text\", \"[\" + mRule + \"]\", \"Matching rules JSON\");\n  Testing.setVar(\"settings\", JSONF.stringify(optionSettings), \"Current settings\");\n\n  // If there is only one match we need something in the testpage to click on\n  if(matchingRules.length + lastMatchingWorkflows.length === 1) {\n    Testing.setVar(\"popup-html\", \"<li class='select-rule' data-rule-name='\" + matchingRules[0].name.replace(/[^a-zA-Z-]/g, \"-\").toLowerCase() + \"'>\" + matchingRules[0].name + \"</li>\", \"Popup HTML (one match)\");\n  }\n};\n\n// When the user changes a tab, search for matching rules for that url\n// or matching rules for that content\nvar onTabReadyRules = function(tabId) {\n  lastMatchingRules = [];\n\n  // Clear popup HTML\n  chrome.browserAction.setPopup({\"tabId\": tabId, \"popup\": \"\"});\n  Logger.info(\"[bg.js] onTabReadyRules on Tab \" + tabId);\n\n  chrome.tabs.get(tabId, function(tab) {\n\n    // return if the tab isn't active anymore\n    if (chrome.runtime.lastError || !tab.active || tab.url.indexOf(\"chrome\") === 0) {\n      return;\n    }\n\n    window.lastActiveTab = tab;\n    Logger.info(\"[bg.js] Setting active tab\", tab);\n\n    // This is a little bit complicated.\n    // I wish the chromium API would implement Promises for all that.\n    Rules.all().then(function (rules) {\n      // First filter all rules that have content matchers\n      var relevantRules = rules.filter(function (rule) {\n        return typeof rule.content !== \"undefined\";\n      });\n\n      // Send these rules to the content script so it can return the matching\n      // rules based on the regex and the pages content\n      var message = { \"action\": \"matchContent\", \"rules\": JSONF.stringify(relevantRules)};\n      chrome.tabs.sendMessage(tabId, message, function (matchingContentRulesIds) {\n        var matchingContentRules = [];\n\n        // If we found rules that match by content ...\n        if(typeof matchingContentRulesIds !== \"undefined\") {\n          //TODO: since matchingContentRulesIds is a string we should JSPNF.parse it\n          // this mystically fails :( don't know why yet. (FS, 2015-11-16)\n          // matchingContentRulesIds = JSONF.parse(matchingContentRulesIds)\n          // after fixing remove rules.unique!\n          // ... select rules that match those ids\n          matchingContentRulesIds = JSONF.parse(matchingContentRulesIds);\n          if(typeof matchingContentRulesIds !== \"undefined\" && matchingContentRulesIds.length > 0) {\n            matchingContentRules = rules.filter(function (rule) {\n              return matchingContentRulesIds.indexOf(rule.id) > -1;\n            });\n\n            // Add the rules to the rule that matches by url\n            lastMatchingRules = lastMatchingRules.concat(matchingContentRules);\n          }\n        }\n        Logger.info(\"[bg.js] Got \" + matchingContentRules.length + \" rules matching the content of the page\");\n\n        // Now match those rules that have a \"url\" matcher\n        Rules.match(tab.url).then(function (matchingRules) {\n          Logger.info(\"[bg.js] Got \" + matchingRules.length + \" rules matching the url of the page\");\n\n          // Concatenate matched rules by CONTENT and URL\n          lastMatchingRules = Rules.unique(lastMatchingRules.concat(matchingRules));\n\n          // Save rules to localStorage for popup to load\n          Rules.lastMatchingRules(lastMatchingRules);\n\n          // Now find and save the matching workflows for those rules\n          Workflows.matchesForRules(lastMatchingRules).then(function prMatchingWfs(matchingWfs) {\n            Workflows.saveMatches(matchingWfs);\n\n            // Show matches in badge\n            totalMatchesCount = lastMatchingRules.length + matchingWfs.length;\n            refreshMatchCounter(tab, totalMatchesCount);\n\n            // TESTING\n            if(!Utils.isLiveExtension()) {\n              reportMatchingRulesForTesting(lastMatchingRules, matchingWfs);\n            }\n\n            // No matches? Multiple Matches? Show popup when the user clicks on the icon\n            // A single match should just fill the form (see below)\n            if (totalMatchesCount !== 1 || optionSettings.alwaysShowPopup) {\n              chrome.browserAction.setPopup({\"tabId\": tab.id, \"popup\": \"html/popup.html\"});\n              if (!Utils.isLiveExtension()) {\n                Testing.createCurrentPopupInIframe(tab.id);\n              }\n            } else if (lastMatchingRules[0].autorun === true) {\n              // If the rule is marked as \"autorun\", execute the rule if only\n              // one was found\n              Logger.info(\"[bj.js] Rule is set to autorun\");\n              FormUtil.applyRule(lastMatchingRules[0], window.lastActiveTab);\n            }\n          });\n        });\n\n      });\n    });\n  });\n};\n\n// Load running workflow storage\n// and run the next step\nvar onTabReadyWorkflow = function() {\n  return new Promise(function (resolve) {\n    Storage.load(Utils.keys.runningWorkflow).then(function prOnTabReadyWf(runningWorkflow) {\n      // No running workflow?\n      if(typeof runningWorkflow === \"undefined\" || !window.lastActiveTab) {\n        resolve({status: \"not_running\", runRule: true});\n        return;\n      }\n\n      // End of workflow reached\n      if(runningWorkflow.currentStep >= runningWorkflow.steps.length) {\n        FormUtil.displayMessage(\"Workflow finished!\", window.lastActiveTab);\n        Storage.delete(Utils.keys.runningWorkflow);\n\n        // Search for matching rules and workflows\n        // to fill the icon again\n        runWorkflowOrRule(window.lastActiveTab.id);\n\n        resolve({status: \"finished\", runRule: false});\n        return;\n      }\n\n      // load rule for workflow step\n      var ruleNameToRun = runningWorkflow.steps[runningWorkflow.currentStep];\n      Logger.info(\"[background.js] Using workflow step # \" + (runningWorkflow.currentStep + 1) + \" (\" + ruleNameToRun + \")\");\n      setBadge(\"#\" + (runningWorkflow.currentStep + 1), window.lastActiveTab.id);\n\n      Rules.findByName(ruleNameToRun).then(function prExecWfStep(rule) {\n        if(typeof rule === \"undefined\") {\n          // report not found rule in options, cancel workflow\n          FormUtil.displayMessage(\"Workflow error: rule not found!\", window.lastActiveTab);\n          Storage.delete(Utils.keys.runningWorkflow);\n\n          // Search for matching rules and workflows\n          runWorkflowOrRule(window.lastActiveTab.id);\n\n          resolve({status: \"rule_not_found\", runRule: false});\n        } else {\n          // Should a screenshot be taken?\n          if(runningWorkflow.flags && runningWorkflow.flags.screenshot === true) {\n            Logger.info(\"[background.js] setting rule.screenshot = true because Wf config said so\");\n            rule.screenshot = true;\n          }\n\n          // Fill with this rule\n          FormUtil.displayMessage(\"Workflow step \" + (runningWorkflow.currentStep + 1) + \"/\" + runningWorkflow.steps.length, window.lastActiveTab);\n          FormUtil.applyRule(rule, window.lastActiveTab);\n\n          // Save workflow state so we can continue even after a page reload\n          Storage.save({\n            currentStep: runningWorkflow.currentStep + 1,\n            steps: runningWorkflow.steps,\n            flags: runningWorkflow.flags\n          }, Utils.keys.runningWorkflow).then(function () {\n            resolve({status: \"running_workflow\", runRule: false});\n          });\n        }\n      });\n\n      // Running workflow! Don't run normal rules.\n      resolve({status: \"running_workflow\", runRule: false});\n    });\n  });\n};\n\n// Searches for workflows or rules to run\n// Workflows steps are then run and subsequent matching rules are ignored\nrunWorkflowOrRule = function (tabId) {\n  // First check (and run) workflows\n  return onTabReadyWorkflow().then(function prOnTabReadyWf(workflowStatus) {\n    // If a workflow step has been run, don't run rules\n    // otherwise do run\n    if(workflowStatus.runRule) {\n      onTabReadyRules(tabId);\n    }\n  });\n};\n\n// Generates a filename that is safe for disc storage\nvar generateFilename = function(metadata) {\n  var ruleNameAsFilename = metadata.name.replace(/[^a-z0-9-_]/gi, '_') + \".jpg\";\n  return \"fof-screenshot-\" + metadata.ruleId.replace(/([0-9]+)-([0-9]+)/, \"tab-$1-rule-$2-field-\") + metadata.fieldIndex + \"_\" + ruleNameAsFilename;\n};\n\n// Takes screenshot of a window\n// and downloads it to disk\nvar takeScreenshot = function(windowId, ruleMetadata, potentialFilename) {\n  var quality = parseInt(optionSettings.jpegQuality, 10) || 60;\n  var fName;\n\n  // force download of the image\n  if(typeof potentialFilename === \"string\") {\n    // use user defined name\n    fName = potentialFilename.replace(/[^a-z0-9-_]/gi, '_') + \".jpg\";\n  } else if(ruleMetadata) {\n    // use generated name\n    fName = generateFilename(ruleMetadata);\n  } else {\n    return;\n  }\n\n  chrome.tabs.captureVisibleTab(windowId, { format: \"jpeg\", quality: quality}, function(screenshotDataUri) {\n    Utils.downloadImage(screenshotDataUri, fName);\n  });\n};\n\n// This function manages the interval that is used if\n// the user has \"reeval-rules\" checked in settings.\n// It executes the rules matching every two seconds\nvar setCyclicRulesRecheck = function(shouldCheck) {\n  if(recheckInterval) {\n    clearInterval(recheckInterval);\n    recheckInterval = null; // Collect it\n    Logger.info(\"[bg.js] Deactivate interval for rule rechecking\");\n    useBadgeBgColor = defaultBadgeBgColor;\n  }\n\n  if(shouldCheck) {\n    recheckInterval = setInterval(function() {\n      if(window.lastActiveTab !== null) {\n        runWorkflowOrRule(window.lastActiveTab.id);\n      }\n    }, Utils.reevalRulesInterval);\n    Logger.info(\"[bg.js] Activate interval for rule rechecking\");\n    useBadgeBgColor = intervalBadgeBgColor;\n  }\n\n  // Set BG color now even if not rematching has been done\n  if(window.lastActiveTab !== null) {\n    chrome.browserAction.setBadgeBackgroundColor({\"color\": useBadgeBgColor, \"tabId\": window.lastActiveTab.id});\n  }\n};\n\n// Fires when a tab becomes active (https://developer.chrome.com/extensions/tabs#event-onActivated)\nchrome.tabs.onActivated.addListener(function (activeInfo) {\n  runWorkflowOrRule(activeInfo.tabId);\n});\n\n// Fires when the URL changes (https://developer.chrome.com/extensions/tabs#event-onUpdated)\nchrome.tabs.onUpdated.addListener(function (tabId, changeInfo) {\n  if(changeInfo.status && changeInfo.status === \"complete\") {\n    runWorkflowOrRule(tabId);\n  }\n});\n\n// This event will only fire if NO POPUP is set\n// This is the case when only one rule matches\nchrome.browserAction.onClicked.addListener(function (){\n  FormUtil.applyRule(lastMatchingRules[0], window.lastActiveTab);\n});\n\n// Listen for messages from other background/popup scripts\n// Also listens to messages from testcases\nchrome.extension.onMessage.addListener(function(message, sender, sendResponse) {\n\n  Logger.info(\"[bj.js] Received message \" + JSONF.stringify(message));\n\n  // From popup.js:\n  // This receives the index of the rule to apply when there is more than one match\n  if (message.action === \"fillWithRule\") {\n    Logger.info(\"[bg.js] called by popup.js with rule index \" + message.index + \", id = \" + message.id);\n    // Find the rule by id\n    var rules = lastMatchingRules.filter(function (rule) {\n      return rule.id === message.id;\n    });\n    FormUtil.applyRule(rules[0], window.lastActiveTab);\n    sendResponse(true);\n  }\n\n  // From popup.js:\n  // Apply a workflow starting at the first step / rule\n  if (message.action === \"fillWithWorkflow\") {\n    // Load previously saved matching workflows\n    Workflows.findById(message.id).then(function prLoadMatches(matchingWf) {\n      // Now save the steps of that workflow to the storage and\n      // mark the current running workflow\n      Storage.save({ currentStep: 0, steps: matchingWf.steps, flags: matchingWf.flags }, Utils.keys.runningWorkflow).then(function () {\n        onTabReadyWorkflow();\n      });\n    });\n    sendResponse(true);\n  }\n\n  // Open an intern URL (aka. options).\n  // Callable by content script that otherwise isn't allowed to open intern urls.\n  if(message.action === \"openIntern\" && message.url) {\n    Logger.info(\"[bg.js] received 'openIntern' with url '\" + message.url + \"'\");\n    chrome.tabs.create({ \"active\": true, \"url\": message.url });\n  }\n\n  // Display a notification to the user that the extract has finished\n  if(message.action === \"extractFinishedNotification\") {\n    Logger.info(\"[bg.js] received 'extractFinishedNotification'\");\n    Notification.create(\"Extracted your form. Click here to check the options panel for more info.\", null, Utils.openOptions);\n  }\n\n  // Return the last active tab id\n  if(message.action === \"lastActiveTabId\" && window.lastActiveTab !== null) {\n    Logger.info(\"[bg.js] received 'lastActiveTabId'. Sending tabId \" + window.lastActiveTab.id);\n    sendResponse(window.lastActiveTab.id);\n  }\n\n  // received from options.js to reload Libs\n  if(message.action === \"reloadLibs\" && window.lastActiveTab !== null) {\n    // Why reload libs? If the user changes a tab containing a library definition\n    // we must update it before the user executes a rule\n    // Otherwise the new function won't be found\n    // This is only useful for library functions used in before functions since those are\n    // evaluated in the context of the background page\n    Libs.import();\n  }\n\n  // Toggle rematch mode on/off\n  if(message.action === \"testToggleRematch\") {\n    optionSettings.reevalRules = !optionSettings.reevalRules;\n    setCyclicRulesRecheck(optionSettings.reevalRules);\n  }\n});\n\n// Saves settings changed by popup or settings page\n/*eslint-disable no-unused-vars */\nvar setSettings = function(settings, value) {\n  // First form key => value\n  if(typeof value !== \"undefined\") {\n    optionSettings[settings] = value;\n  } else {\n    // Second form: set all\n    optionSettings = settings;\n  }\n\n  // Save settings\n  Storage.save(optionSettings, Utils.keys.settings);\n\n  // Set cyclic refresh if neccessary\n  setCyclicRulesRecheck(optionSettings.reevalRules);\n\n  Testing.setVar(\"settings\", JSONF.stringify(optionSettings), \"Current settings\");\n  Logger.info(\"[bg.js] Settings set to \" + JSONF.stringify(optionSettings));\n\n  // Tell options page to reload the settings\n  chrome.runtime.sendMessage({action: \"reloadSettings\"});\n};\n/*eslint-enable no-unused-vars */\n\n// REMOVE START\n// Debug Messages from content.js\nchrome.runtime.onConnect.addListener(function (port) {\n  port.onMessage.addListener(function(message) {\n    if(message.action === \"log\" && message.message) {\n      Logger.store(message.message);\n    }\n  });\n});\n// REMOVE END\n\n// Listen for messages from content.js\nchrome.runtime.onMessage.addListener(function (message) {\n  // REMOVE START\n  if(message.action === \"log\" && message.message) {\n    Logger.store(message.message);\n  }\n  // REMOVE END\n\n  // The content page (form_filler.js) requests a screenshot to be taken\n  // the message.flag can be the filename or true/false\n  if(message.action === \"takeScreenshot\" && typeof message.flag !== \"undefined\") {\n    Logger.info(\"[bg.js] Request from content.js to take a screenshot of windowId \" + window.lastActiveTab.windowId);\n    takeScreenshot(window.lastActiveTab.windowId, message.value, message.flag);\n  }\n});\n\n// Fires when the extension is install or updated\nchrome.runtime.onInstalled.addListener(function (details) {\n  Logger.info(\"[bg.js] runtime.onInstalled fired\");\n\n  // Called on very first install\n  if (details.reason === \"install\") {\n    Notification.create(chrome.i18n.getMessage(\"first_install_notification\"), null, function () {\n      Utils.openOptions(\"#help\");\n    });\n  }\n\n  // Check if tabs are saved or we start from scratch\n  Storage.load(Utils.keys.tabs).then(function (tabSettings) {\n    // No tab settings found, create one\n    if(typeof tabSettings === \"undefined\") {\n      Logger.info(\"[bg.js] Creating default tab setting\");\n      Storage.save([{\n        \"id\": 1,\n        \"name\": chrome.i18n.getMessage(\"tabs_default_name\")\n      }], Utils.keys.tabs);\n    }\n  });\n\n  // remove log entries\n  Logger.delete();\n\n  // Check if there are notifications to display\n  if(Utils.version.indexOf(\".\") > -1) {\n    Notification.forVersion(Utils.version);\n  }\n});\n\n//\n// WHEN THIS FILE IS LOADED:\n//\n\n// Load the settings and defulat them if not saved before\nStorage.load(Utils.keys.settings).then(function(settings) {\n  Logger.info(\"[bg.js] loading settings : \" + JSONF.stringify(settings));\n  if(typeof settings === \"undefined\") {\n    settings = Utils.defaultSettings;\n  }\n  optionSettings = settings;\n  setCyclicRulesRecheck(optionSettings.reevalRules);\n});\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./background/background.js\n **/","/*eslint no-unused-vars: 0 */\nimport Logger from \"../debug/logger\";\nimport Rules from \"../global/rules\";\nimport Utils from \"../global/utils\";\nimport JSONF from \"../global/jsonf\";\nimport Workflows from \"../global/workflows\";\n\nvar Testing = {\n  setVar: function(key, value, textToDisplay) {\n    var message = {\n      action: \"setTestingVar\",\n      key: key,\n      value: value,\n      text: textToDisplay || null\n    };\n    Logger.debug(\"[b/testing.js] Sending (\" + (textToDisplay || \"\") + \") \" + key + \" = \" + value + \" to c/testing.js\");\n    if (window.lastActiveTab !== null) {\n      chrome.tabs.sendMessage(window.lastActiveTab.id, message, function () {});\n    }\n  },\n  appendTestLog: function(msg) {\n    if (window.lastActiveTab !== null) {\n      chrome.tabs.sendMessage(window.lastActiveTab.id, { action: \"appendTestLog\", value: msg}, function () {});\n    }\n  },\n  // This method takes the otherwise inaccessable popup.html\n  // and puts it into an <div> in the BG page\n  // This process renders the popup (including all JS).\n  // The popup then sends its rendered HTML to content.js\n  // This is the only method to \"click\" and thereby view the popup HTML without\n  // actually clicking on it.\n  // Enables end to end testing because the browserAction cannot be clicked in tests.\n  createCurrentPopupInIframe: function(tabId) {\n    chrome.browserAction.getPopup({\"tabId\": tabId}, function (popupUrl) {\n      var iframePopup = document.querySelector(\"#form-o-fill-popup-iframe\");\n      if (iframePopup) {\n        iframePopup.src = popupUrl;\n      } else {\n        iframePopup = document.createElement(\"iframe\");\n        iframePopup.id = \"form-o-fill-popup-iframe\";\n        iframePopup.src = popupUrl;\n        document.querySelector(\"body\").appendChild(iframePopup);\n      }\n    });\n  }\n};\n\n// Listener for messages from content.js -> testing.js\nchrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {\n\n  // Activate testing mode\n  // Sends extension infos back to content/testing.js\n  if (message.action === \"setTestingMode\") {\n    /*eslint-disable no-undef, block-scoped-var*/\n    testingMode = message.value;\n    /*eslint-enable no-undef, block-scoped-var*/\n\n    // useful info to display in the testing page\n    Rules.all().then(function (rules) {\n\n      var ruleCount = rules.filter(function (rule) {\n        return typeof rule.name !== \"undefined\" && typeof rule.fields !== \"undefined\";\n      }).length;\n\n      var info = {\n        testingMode: message.value,\n        extensionId: sender.id,\n        extensionVersion: Utils.version,\n        tabId: sender.tab.id,\n        ruleCount: ruleCount,\n        libCount: rules.length - ruleCount\n      };\n      Logger.debug(\"[b/testing.js] Set testingMode to \" + message.value);\n\n      sendResponse(info);\n    });\n  }\n\n  // Import Rules\n  // Sends importInfo back to content/testing.js\n  if(message.action === \"importRules\") {\n    var parsed = JSONF.parse(message.value);\n    var promises = [];\n    var rulesToImport = null;\n    var tabSettingsToImport = null;\n\n    // Import can be rules only or rules+workflows\n    if(typeof parsed.rules !== \"undefined\" && typeof parsed.rules.rules !== \"undefined\") {\n      rulesToImport = parsed.rules.rules;\n      tabSettingsToImport = parsed.rules.tabSettings;\n    } else {\n      rulesToImport = parsed.rules;\n      tabSettingsToImport = parsed.tabSettings;\n    }\n\n    // Save all tabs separatly\n    rulesToImport.forEach(function (editorTabAndRules) {\n      promises.push(Rules.save(editorTabAndRules.code, editorTabAndRules.tabId));\n    });\n    // save tabsetting\n    promises.push(Storage.save(tabSettingsToImport, Utils.keys.tabs));\n\n    // Save workflows?\n    if(typeof parsed.workflows !== \"undefined\") {\n      Workflows.save(parsed.workflows);\n    }\n\n    Promise.all(promises).then(function () {\n      sendResponse(true);\n    });\n  }\n\n  // Signal chrome that we plan to call the sendResponse() callback asynchronously\n  // (See Promise.all above)\n  // See https://developer.chrome.com/extensions/runtime#event-onMessage\n  return true;\n});\n\nmodule.exports = Testing;\n\n\n\n/** WEBPACK FOOTER **\n ** ./background/testing.js\n **/","/*eslint no-unused-vars:0 */\nimport Logger from \"../debug/logger\";\nimport Utils from \"../global/utils\";\nimport JSONF from \"../global/jsonf\";\nimport Storage from \"../global/storage\";\nimport jQuery from \"jquery\";\n\nvar Workflows = {\n  load: function() {\n    return new Promise(function (resolve) {\n      Storage.load(Utils.keys.workflows).then(function prWfLoad(workflows) {\n        if(typeof workflows === \"undefined\") {\n          resolve([]);\n        } else {\n          resolve(workflows);\n        }\n      });\n    });\n  },\n  findById: function(id) {\n    return new Promise(function (resolve) {\n      Workflows.load().then(function prFindById(wfs) {\n        resolve(wfs.filter(function (wf) {\n          /*eslint-disable eqeqeq*/\n          return wf.id == id;\n          /*eslint-enable eqeqeq*/\n        })[0]);\n      });\n    });\n  },\n  save: function(workflowData) {\n    Logger.info(\"[g/workflow.js] Saving \" + workflowData.length + \" workflows\");\n    return Storage.save(workflowData, Utils.keys.workflows);\n  },\n  delete: function(workflowId) {\n    this.load().then(function(workflows) {\n      var newWfs = workflows.filter(function wfFilterDel(wf) {\n        /*eslint-disable eqeqeq*/\n        return wf.id != workflowId;\n        /*eslint-enable eqeqeq*/\n      });\n      Workflows.save(newWfs);\n    });\n  },\n  matchesForRules: function(rules) {\n    return new Promise(function (resolve) {\n      // Find workflows that match those rules (start only)\n      var matchingRuleNames = rules.map(function cbStepsMap(rule) {\n        return rule.name;\n      });\n\n      Workflows.load().then(function prMatchesForRules(workflows) {\n        var matchingWorkflows = workflows.filter(function cbWfFilter(workflow) {\n          return matchingRuleNames.indexOf(workflow.steps[0]) === 0;\n        });\n        resolve(matchingWorkflows);\n      });\n    });\n  },\n  saveMatches: function(workflows) {\n    return Storage.save(JSONF.stringify(workflows), Utils.keys.lastMatchingWorkflows);\n  },\n  loadMatches: function() {\n    return new Promise(function (resolve) {\n      Storage.load(Utils.keys.lastMatchingWorkflows).then(function (rawMatches) {\n        resolve(JSONF.parse(rawMatches));\n      });\n    });\n  },\n  exportDataJson: function() {\n    return new Promise(function (resolve) {\n      Storage.load(Utils.keys.workflows).then(function(workflowData) {\n\n        // Not workflow saved yet.\n        if (typeof workflowData === \"undefined\") {\n          resolve([]);\n        }\n\n        workflowData = workflowData.map(function cbWfDataMap(workflow) {\n          workflow.steps = jQuery.makeArray(workflow.steps);\n          return workflow;\n        });\n\n        resolve(workflowData);\n      });\n    });\n  }\n};\n\nmodule.exports = Workflows;\n\n\n\n/** WEBPACK FOOTER **\n ** ./global/workflows.js\n **/","/* eslint complexity: [2, 6] */\nimport Rules from \"../global/rules\";\nimport Utils from \"../global/utils\";\nimport Logger from \"../debug/logger\";\nimport JSONF from \"../global/jsonf\";\nimport Libs from \"../global/libs\";\n\nvar FormUtil = {\n  lastRule: null,\n  functionToHtml: function functionToHtml(func) {\n    return func.toString().replace(/ /g, \"&nbsp;\").split(\"\\n\").join(\"<br />\");\n  },\n  _findImport: function _findImport(ruleName) {\n    return new Promise(function findImportPromise(resolve) {\n      Rules.all().then(function findImportThen(rules) {\n        var ruleToImport = rules.filter(function findImportFilter(aRule) {\n          return aRule.name === ruleName;\n        })[0];\n        resolve({\n          ruleToImport: ruleToImport || null,\n          ruleThatImports: ruleName\n        });\n      });\n    });\n  },\n  resolveImports: function resolveImports(rule) {\n    return new Promise(function (resolve) {\n      // Find field definitions containing the \"import\" property and\n      // lookup the matching rule.\n      // Returns an array of promises\n      var importableRulesPromises = rule.fields.filter(function importableRulesFilter(fieldDef) {\n        return typeof fieldDef.import !== \"undefined\";\n      }).map(function importableRulesMap(fieldDef) {\n        return FormUtil._findImport(fieldDef.import);\n      });\n\n      // resolve found shared rules\n      Promise.all(importableRulesPromises).then(function importableRulesPromises2(arrayOfRules) {\n        var lookup = {};\n        if(arrayOfRules.length > 0) {\n          Logger.info(\"[b/form_util.js] Found importable rules:\", arrayOfRules);\n        }\n\n        // Check for imports that could not be found\n        var missingImports = arrayOfRules.filter(function importWithoutRules(element) {\n          return element.ruleToImport === null;\n        });\n\n        if(missingImports.length > 0) {\n          Notification.create(chrome.i18n.getMessage(\"notification_import_without_rule\"), null, function importWithoutRule() {\n            var errors = missingImports.map(function (element) {\n              return { fullMessage: \"Missing rule is named '\" + element.ruleThatImports + \"'\" };\n            });\n            FormUtil.saveErrors(errors, rule);\n          });\n        }\n\n        // revert changes made by importable rules\n        arrayOfRules = arrayOfRules.map(function(importRuleConstruct) {\n          return importRuleConstruct.ruleToImport;\n        });\n\n        // Create a lookup hash\n        arrayOfRules.filter(function arrayOfRulesFilter(aRule) {\n          return aRule !== null;\n        }).forEach(function arrayOfRulesLoop(ruleToImport) {\n          lookup[ruleToImport.name] = ruleToImport.fields;\n        });\n\n        // If there are no lookup entries\n        // we can return here\n        if(Object.keys(lookup).length > 0) {\n          // Walk through all fields and replace imports with the field definitions\n          // from the shared rule\n          rule.fields.forEach(function resolveImportsFields(field, fieldIndex) {\n            // replace a field with \"import\" with the corresponding rule\n            if(typeof field.import !== \"undefined\" && typeof lookup[field.import] !== \"undefined\") {\n              // Insert the rules at the \"import\" spot\n              rule.fields.splice.apply(rule.fields, [fieldIndex, 1].concat(lookup[field.import]));\n            }\n          });\n        }\n\n        // Kill reference for GC\n        arrayOfRules = null;\n\n        // Resolve that final rule\n        resolve(rule);\n      });\n    });\n  },\n  saveErrors: function saveErrors(errors, rule) {\n    // Save the errors to local storage\n    Storage.save({\"errors\": errors, \"rule\": rule}, Utils.keys.errors).then(function storageSave() {\n      Utils.openOptions();\n    });\n  },\n  displayMessage: function displayMsg(msg, lastActiveTab) {\n    var port = chrome.tabs.connect(lastActiveTab.id, {name: \"FormOFill\"});\n    port.postMessage({action: \"showMessage\", message: msg});\n  },\n  sendLibsReloadToContent: function(port) {\n    port.postMessage({\"action\": \"reloadLibs\"});\n  },\n  buildFlags: function(ruleDef, fieldDef) {\n    // onlyEmpty:  If true only fills the field if the target is currently \"empty\"\n    //             Can be set on rules or field defs. Latter overwrites first.\n    // screenshot: Takes a screenshot if truthy. If string saves it under that name.\n    var onlyEmpty;\n    onlyEmpty = typeof ruleDef.onlyEmpty === \"boolean\" ? ruleDef.onlyEmpty : false;\n    onlyEmpty = typeof fieldDef.onlyEmpty === \"boolean\" ? fieldDef.onlyEmpty : onlyEmpty;\n\n    var screenshot;\n    screenshot = typeof fieldDef.screenshot !== \"undefined\" ? fieldDef.screenshot : false;\n\n    return {\n      onlyEmpty: onlyEmpty,\n      screenshot: screenshot\n    };\n  },\n  sendFieldsToContent: function(aRule, beforeData, port) {\n    // Now send all field definitions to the content script\n    var message;\n    var screenshotFlagFromRule = aRule.screenshot === true ? true : false;\n\n    aRule.fields.forEach(function ruleFieldsForEach(field, fieldIndex) {\n      // If the rule has screenshot : true and this is the last executing field definition\n      // take a screenshot via the fields screenshot flag\n      if(screenshotFlagFromRule && fieldIndex === aRule.fields.length - 1) {\n        Logger.info(\"[b/form_util.js] Flagging field #\" + fieldIndex + \" with screenshot = true (rule: \" + aRule.nameClean + \")\");\n        field.screenshot = true;\n      }\n\n      // The message contains ...\n      //\n      // action: \"fillField\"\n      // selector: the query selector to use\n      // value: The value to fill the field with (or a value function to execute)\n      // flags: boolean flags to honor (like onlyEmpty)\n      // beforeData: The resolved before data\n      // meta: meta data about the source of the data\n      message = {\n        \"action\": \"fillField\",\n        \"selector\": field.selector,\n        \"value\": JSONF.stringify(field.value),\n        \"flags\": FormUtil.buildFlags(aRule, field),\n        \"beforeData\": beforeData,\n        \"meta\": {\n          \"ruleId\": aRule.id,\n          \"name\": aRule.nameClean,\n          \"fieldIndex\": fieldIndex,\n          \"lastField\": fieldIndex === aRule.fields.length - 1 ? true : false\n        }\n      };\n      port.postMessage(message);\n      Logger.info(\"[b/form_util.js] Posted to content.js: Fill \" + field.selector + \" with \" + field.value);\n    });\n  },\n  reportErrors: function(theErrors, rule, port) {\n    Logger.warn(\"[b/form_util.js] Received 'getErrors' with \" + theErrors.length + \" errors\");\n    if(theErrors.length > 0) {\n      Notification.create(\"There were \" + theErrors.length + \" errors while filling this form. Click here to view them.\", null, function notificationCreated() {\n        FormUtil.saveErrors(theErrors, rule);\n      });\n    }\n    port.postMessage({\"action\": \"hideWorkingOverlay\"});\n  },\n  injectAndAttachToLibs: function(pathToScript, nameOnLib, nameOnWindow) {\n    return new Promise(function (resolve) {\n      // First inject the library itself (eg. moment.js)\n      chrome.tabs.executeScript(null, {file: pathToScript}, function () {\n        // When the library is injected, bind it to \"Libs\"\n        chrome.tabs.executeScript({code: \"Libs.add('\" + nameOnLib + \"', window.\" + nameOnWindow + \");\"}, function () {\n          Logger.info(\"[b/form_util.js] Libs.add('\" + nameOnLib + \"', window.\" + nameOnWindow + \");\");\n          resolve(pathToScript);\n        });\n      });\n    });\n  },\n  generateLibsPromises: function(libs) {\n    // Inject the libs into the page\n    // Build an array starting with an instant resolving promise\n    var prUsedLibs = [ new Promise(function (resolve) {\n      resolve();\n    }) ];\n\n    // There are libraries present\n    // so add them to the stack\n    if(libs.length > 0) {\n      // Generate a promise for every used lib\n      libs.forEach(function (libPath) {\n        prUsedLibs.push(FormUtil.injectAndAttachToLibs(libPath, Utils.vendoredLibs[libPath].name, Utils.vendoredLibs[libPath].onWindowName));\n      });\n    }\n\n    return prUsedLibs;\n  },\n  createGrabber: function(lastActiveTabId) {\n    // the grabber is passed as part of the context\n    // it can fetch content from the open webpage\n    // usage: context.findHtml(\"a.getme\").then(function(content) {});\n    return function theRealGrabber(selector) {\n      return new Promise(function (resolve) {\n        var grabberMessage = {\"action\": \"grabContentBySelector\", \"message\": selector.toString()};\n        chrome.tabs.sendMessage(lastActiveTabId, grabberMessage, function returnFromContentGrabber(content) {\n          Logger.info(\"[form_util.js] Received content from 'grabber': '\" + content + \"'\");\n          resolve(content);\n        });\n      });\n    };\n  },\n  wrapInPromise: function wrapInPromise(func, context) {\n    // Utility function to wrap a function in\n    // a promise\n    return new Promise(function promise(resolve) {\n      try {\n        func(resolve, context);\n      } catch (e) {\n        Logger.warn(\"[b/form_util.js] Got an exception executing before function: \" + func);\n        Logger.warn(\"[b/form_util.js] Original exception: \" + e);\n        Logger.warn(\"[b/form_util.js] Original stack: \" + e.stack);\n\n        var error = {\n          error: {\n            beforeFunction: FormUtil.functionToHtml(func),\n            stack: e.stack,\n            message: e.message\n          }\n        };\n        resolve(error);\n      }\n    });\n  },\n  storage: {\n    // Why use localStorage here instead of chrome.storage?\n    // localStorage is synchronous and this is way easier to use than\n    // callbacks or promises\n    base: window.sessionStorage.getItem(Utils.keys.sessionStorage) || {},\n    get: function(key) {\n      if(typeof this.base[key] === \"undefined\") {\n        return this.base[key];\n      }\n      return JSONF.parse(this.base[key]);\n    },\n    set: function(key, value) {\n      this.base[key] = JSONF.stringify(value);\n      // Also set the variable in content.js\n      chrome.tabs.sendMessage(window.lastActiveTab.id, {action: \"storageSet\", key: key, value: this.base[key]});\n      // Save in background.js\n      window.sessionStorage.setItem(Utils.keys.sessionStorage, this.base);\n      return window.sessionStorage;\n    },\n    delete: function() {\n      window.sessionStorage.setItem(Utils.keys.sessionStorage, \"{}\");\n    }\n  },\n  generateFunctionsPromises: function(beforeOrAfter, rule, context) {\n    // Default instantaneous resolving promise:\n    var prepFunctions = [function beforeFuncPromise() {\n      return new Promise(function promise(resolve) {\n        resolve(null);\n      });\n    }];\n\n    // Is there a 'before' or 'after' block with an function or an array of functions?\n    if(typeof rule[beforeOrAfter] === \"function\") {\n      // A single before function\n      prepFunctions = [ FormUtil.wrapInPromise(rule[beforeOrAfter], context) ];\n    } else if(typeof rule[beforeOrAfter] === \"object\" && typeof rule[beforeOrAfter].length !== \"undefined\") {\n      // Assume an array of functions\n      prepFunctions = rule[beforeOrAfter].map(function beforeFuncMap(func) {\n        return FormUtil.wrapInPromise(func, context);\n      });\n    }\n\n    Logger.info(\"[form_util.js] set '\" + beforeOrAfter + \"' function to \" + JSONF.stringify(rule[beforeOrAfter]));\n\n    return prepFunctions;\n  },\n  createContext: function() {\n    // The context is passed as the second argument to the before function.\n    // It represents to environment in which the rule is executed.\n    // It also contains the grabber which can find content inside the current webpage\n    // and the storage object\n    return {\n      url: Utils.parseUrl(window.lastActiveTab.url),\n      findHtml: FormUtil.createGrabber(window.lastActiveTab.id),\n      storage: FormUtil.storage\n    };\n  },\n  generateSetupContentPromise: function(setupContentFunc, port) {\n    // This returns a promise that resolves when the\n    // content.js has executed the setupContent function\n    return new Promise(function (resolve) {\n      Logger.info(\"[form_util.js] Adding setupContent promise to stack\");\n      port.postMessage({ \"action\": \"setupContent\", \"value\": JSONF.stringify(setupContentFunc) });\n      port.onMessage.addListener(function(message) {\n        // The content.js will post a complete message when the setupContent function has been\n        // executed\n        if(message.action === \"setupContentDone\") {\n          resolve();\n        }\n      });\n    });\n  },\n  applyRule: function applyRule(rule, lastActiveTab) {\n    this.lastRule = rule;\n    var beforeData;\n    var errors = [];\n\n    // Whatever the reason. Sometimes the rule is undefined when this is called\n    if(typeof rule === \"undefined\") {\n      Logger.info(\"[form_util.js] this.lastRule is undefined. Canceling application of rule.\");\n      return;\n    }\n\n    // Open long standing connection to the tab containing the form to be worked on\n    if(typeof lastActiveTab === \"undefined\") {\n      Logger.info(\"[form_util.js] lastActivetab has gone away. Exiting.\");\n      return;\n    }\n    var port = chrome.tabs.connect(lastActiveTab.id, {name: \"FormOFill\"});\n\n    // Now we can display the WORKING throbber!\n    port.postMessage({\"action\": \"showOverlay\"});\n\n    // reload LIBS just in case\n    FormUtil.sendLibsReloadToContent(port);\n    Libs.import();\n\n    Logger.info(\"[form_utils.js] Applying rule \" + JSONF.stringify(this.lastRule.name) + \" (\" + JSONF.stringify(this.lastRule.fields) + \") to tab \" + lastActiveTab.id);\n\n    // Detect vendored libraries in before functions and import them into Libs\n    Libs.detectLibraries(JSONF.stringify(rule.before)).forEach(function (libPath) {\n      Logger.info(\"[b/form_util.js] Assigning \" + libPath + \" as it is used in the before function\");\n      Libs.add(Utils.vendoredLibs[libPath].name, window[Utils.vendoredLibs[libPath].onWindowName]);\n    });\n\n    // Promises for before functions:\n    var promises = this.generateFunctionsPromises(\"before\", rule, FormUtil.createContext());\n\n    // Resolve all promises\n    // call either the instantaneously resolving Promise (default) or\n    // the array of before functions defined in the rule.\n    //TODO: move to sep functions (FS, 2015-10-07)\n    Promise.all(promises).then(function beforeFunctionsPromise(data) {\n      beforeData = data;\n\n      // If the first beforeData is a function and executes to null then\n      // the rules and workflows that are running should be *canceled*\n      if(typeof beforeData[0] === \"function\" && beforeData[0]() === null) {\n        // Cancel workflows\n        Storage.delete(Utils.keys.runningWorkflow);\n\n        // The halting message is shown via Libs.halt(\"the message\");\n        // So nothing to do here\n        // return null to stop precessing\n        return null;\n      }\n\n      // beforeData is null when there is no before function defined in the rule definition\n      if(beforeData !== null) {\n        Logger.info(\"[form_util.js] Got before data: \" + JSONF.stringify(beforeData));\n\n        // Lets see if we got any errors thrown inside the executed before function\n        var filteredErrors = beforeData.filter(function fnFlteredErrors(beforeFunctionData) {\n          return beforeFunctionData && beforeFunctionData.hasOwnProperty(\"error\");\n        });\n\n        if (filteredErrors.length > 0) {\n          // Produce error objects compatible to those used for form filling errors\n          //TODO: extract creation of errors (FS, 2015-10-07)\n          errors = filteredErrors.map(function filteredErrorsMap(errorObj) {\n            return { selector: \"Inside before function\", value: errorObj.error.beforeFunction, message: errorObj.error.message };\n          });\n\n          Notification.create(\"An error occured while executing a before function. Click here to view it.\", null, function notificationCreate() {\n            FormUtil.saveErrors(errors, rule);\n          });\n        }\n      }\n\n      // If there was only one rule\n      // reduce data array to one element\n      if(beforeData.length === 1) {\n        beforeData = beforeData[0];\n      }\n\n      // Detect vendored libraries\n      var usedLibs = Libs.detectLibraries(JSONF.stringify(rule.fields));\n\n      // generate promises for importing those libraries\n      var morePromises = FormUtil.generateLibsPromises(usedLibs);\n\n      // setupContent function defined? Add those to the promises\n      if(typeof rule.setupContent === \"function\") {\n        morePromises.push(FormUtil.generateSetupContentPromise(rule.setupContent, port));\n      }\n\n      // Resolve all promises\n      // lib import + setupContent\n      Promise.all(morePromises).then(function prUsedLibsAll() {\n        // Check for rules to import (shared rules)\n        FormUtil.resolveImports(rule).then(function resolveImports(aRule) {\n\n          // NOW! Fill that rule\n          //TODO: use a promise here and only getErrors when resolved (FS, 2015-10-07)\n          FormUtil.sendFieldsToContent(aRule, beforeData, port);\n\n          // Get errors. Receiver is in content.js\n          Logger.info(\"[b/form_util.js] Posted to content.js: 'getErrors'\");\n          port.postMessage({\"action\": \"getErrors\"});\n        });\n      });\n\n    }).catch(function error(msg) {\n      console.error(msg);\n    });\n\n    port.onMessage.addListener(function portOnMessageListener(msg) {\n      // Make errors from content scripts available here\n      if(msg.action === \"getErrors\") {\n        var sentErrors = JSONF.parse(msg.errors);\n        FormUtil.reportErrors(sentErrors, rule, port);\n      }\n    });\n\n    // Listen for messages from content.js\n    chrome.runtime.onMessage.addListener(function (message) {\n      // Message that the form filling is done\n      if(message.action === \"fillFieldFinished\") {\n\n        // If the rule has a teardownContent functions execute it\n        // This is sent to content.js and run in the context of the content page\n        if(typeof rule.teardownContent === \"function\") {\n          port.postMessage({ action: \"teardownContent\", value: JSONF.stringify(rule.teardownContent)});\n        }\n\n        // If the rule has a \"after\" function, execute it\n        // It has access to the same context object used in the before function\n        // The signature is the same as with before functions\n        if(typeof rule.after === \"function\") {\n          Promise.all(FormUtil.generateFunctionsPromises(\"after\", rule, FormUtil.createContext())).then(function() {\n            Logger.info(\"[b/form_util.js] Executed after function: \" + JSONF.stringify(rule.after));\n          });\n        }\n      }\n    });\n  }\n};\n\nmodule.exports = FormUtil;\n\n\n\n/** WEBPACK FOOTER **\n ** ./background/form_util.js\n **/","/* Much to be learned here.\n * Simple things can take much longer than expected.\n * The documentation for using the chrome.contextMenus is simple aweful and wrong in some places.\n * You MUST supply an \"id\" field or the contextmenu will not be shown. Its NOT optional as the doc says.\n * */\nvar ContextMenu = {\n  init: function() {\n    chrome.contextMenus.onClicked.addListener(this.ctxHandleExtractClick);\n    chrome.runtime.onInstalled.addListener(function () {\n      chrome.contextMenus.create({\n        \"title\": \"Form-O-Fill: Save Form\",\n        \"contexts\": [\"editable\", \"page\", \"frame\"],\n        \"id\": \"ctxMain\"\n      });\n    });\n  },\n  ctxHandleExtractClick: function(menuItem) {\n    if(menuItem.menuItemId === \"ctxMain\") {\n      var message = {\n        \"action\": \"extractLastClickedForm\"\n      };\n\n      // Send message to content script\n      // to extract last clicked form\n      chrome.tabs.query({\"active\": true, \"lastFocusedWindow\": true}, function(tabs) {\n        chrome.tabs.sendMessage(tabs[0].id, message);\n      });\n    }\n  }\n};\n\nmodule.exports = ContextMenu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./background/context_menu.js\n **/"],"sourceRoot":""}